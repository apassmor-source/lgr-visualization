<!DOCTYPE html>
<html lang="en">
<head>
    <title>LGR Model v2 (Enhanced)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #c5c5c5; /* Fallback color */
            /* Photocopied paper texture using CSS noise */
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj4KPHRpdGxlPk5vaXNlIFBhdHRlcm48L3RpdGxlPgo8ZmlsdGVyIGlkPSJub2lzZSI+CjxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIwLjgiIG51bU9jdGF2ZXM9IjMiIHN0aXRjaFRpbGVzPSJzdGl0Y2giLz4KPGZlQ29tcG9zaXRlIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9Im5vaXNlIiBvcGVyYXRvcj0iaW4iIHJlc3VsdD0ibWFzayIvPgo8ZmVHYXVzc2lhbkJsdXIgaW49Im1hc2siIHN0ZERldmlhdGlvbj0iMCIgcmVzdWx0PSJzaGFycCIvPgo8L2ZpbHRlcj4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI25vaXNlKSIgb3BhY2l0eT0iMC4xNSIvPgo8L3N2Zz4='),
                              linear-gradient(to bottom, #d9d9d9, #b3b3b3);
            color: #222;
            margin: 0;
            overflow: hidden;
        }
        /* Scan lines overlay */
        body::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            z-index: 100;
        }
        #header {
            position: absolute;
            top: 15px;
            left: 25px;
            font-size: 14px;
            line-height: 1.5;
            font-weight: bold;
            z-index: 1;
        }
        #header .redacted {
            background-color: #000;
            color: #000;
            user-select: none;
        }
        #export-button {
            position: absolute;
            top: 15px;
            right: 25px;
            padding: 8px 12px;
            background-color: #bbb;
            border: 1px solid #777;
            cursor: pointer;
            z-index: 1;
        }
        #ui-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(180, 180, 160, 0.85);
            padding: 15px;
            box-sizing: border-box;
            border-top: 2px solid #888;
            z-index: 1;
        }
        #lgr-slider {
            width: 100%;
        }
        #info-display {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        #status-text {
            font-weight: bold;
            text-align: right;
        }
        #description-text {
            margin-top: 10px;
            font-size: 12px;
            min-height: 24px;
        }
    </style>
</head>
<body>

    <div id="header">
        TOP SECRET // <span class="redacted">EYES ONLY</span> // A79001<br>
        SUBJECT: LGR-INDUCED CONSCIOUSNESS TRANSITION
    </div>
    <button id="export-button">Export Brain Model (.stl)</button>

    <div id="ui-panel">
        <label for="lgr-slider">LETTING-GO RATIO (LGR)</label>
        <input type="range" id="lgr-slider" min="0" max="1" step="0.01" value="0">
        <div id="info-display">
            <div id="lgr-value">LGR: 0.00</div>
            <div id="status-text">STATE: Baseline Consciousness</div>
        </div>
        <div id="description-text">DESCRIPTION: Subject at baseline. Analytical mind fully engaged.</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/STLExporter.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.js"></script>

    <script>
        // --- Basic Setup ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.5, 5);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setClearColor(0x000000, 0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        const clock = new THREE.Clock();

        // --- Materials ---
        const defaultMaterial = new THREE.MeshBasicMaterial({ color: 0x222222, wireframe: true });
        const highlightMaterial = new THREE.MeshBasicMaterial({ color: 0x00dddd, wireframe: true });
        const sulciMaterial = new THREE.MeshBasicMaterial({ color: 0x000000, wireframe: true, opacity: 0.5, transparent: true });
        const astralMaterial = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true, transparent: true, opacity: 0 });

        // --- Main Groups ---
        const brainGroup = new THREE.Group();
        const labelsGroup = new THREE.Group();
        scene.add(brainGroup, labelsGroup);

        // --- Brain Model ---
        const hemisphereGeom = new THREE.SphereGeometry(1, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
        const leftHemi = new THREE.Mesh(hemisphereGeom, defaultMaterial);
        leftHemi.rotation.z = -Math.PI / 12;
        leftHemi.position.x = -0.55;
        const rightHemi = new THREE.Mesh(hemisphereGeom, defaultMaterial);
        rightHemi.rotation.z = Math.PI / 12;
        rightHemi.position.x = 0.55;
        brainGroup.add(leftHemi, rightHemi);
        brainGroup.rotation.x = -Math.PI / 8;

        // Add Sulci (Grooves) for detail
        const sulcus1 = new THREE.Mesh(new THREE.TorusGeometry(0.7, 0.03, 8, 32), sulciMaterial);
        sulcus1.rotation.x = Math.PI / 2;
        sulcus1.position.y = 0.3;
        const sulcus2 = sulcus1.clone();
        sulcus2.scale.set(0.8, 0.8, 0.8);
        sulcus2.rotation.z = Math.PI / 3;
        brainGroup.add(sulcus1, sulcus2);
        
        // --- Highlightable Regions ---
        const regionGeom = new THREE.SphereGeometry(0.3, 16, 8);
        const prefrontalCortex = new THREE.Mesh(regionGeom, defaultMaterial);
        prefrontalCortex.position.set(0, 0.8, 0.8);
        brainGroup.add(prefrontalCortex);

        const temporalOccipital = new THREE.Mesh(regionGeom, defaultMaterial);
        temporalOccipital.position.set(0.9, 0.2, -0.3);
        brainGroup.add(temporalOccipital);

        const cerebellum = new THREE.Mesh(new THREE.SphereGeometry(0.4, 16, 8), defaultMaterial);
        cerebellum.position.set(0, -0.6, -0.5);
        brainGroup.add(cerebellum);

        // --- Astral Form ---
        const astralForm = new THREE.Mesh(new THREE.IcosahedronGeometry(1, 0), astralMaterial);
        astralForm.position.y = 1.5;
        astralForm.visible = false;
        scene.add(astralForm);

        // --- UI Elements ---
        const lgrSlider = document.getElementById('lgr-slider');
        const lgrValueDisplay = document.getElementById('lgr-value');
        const statusTextDisplay = document.getElementById('status-text');
        const descriptionTextDisplay = document.getElementById('description-text');

        // --- Core Logic ---
        function updateVisualization(lgr) {
            lgrValueDisplay.textContent = `LGR: ${lgr.toFixed(2)}`;
            prefrontalCortex.material = defaultMaterial;
            temporalOccipital.material = defaultMaterial;
            cerebellum.material = defaultMaterial;
            
            if (lgr <= 0.2) {
                prefrontalCortex.material = highlightMaterial;
                statusTextDisplay.textContent = "STATE: Low Letting-Go";
                descriptionTextDisplay.textContent = "DESCRIPTION: Conscious thinking centered in Prefrontal Cortex. Analytical mind is dominant.";
            } else if (lgr > 0.2 && lgr < 0.9) {
                temporalOccipital.material = highlightMaterial;
                statusTextDisplay.textContent = "STATE: Creative Resonance";
                descriptionTextDisplay.textContent = "DESCRIPTION: Flow emerging. Intuitive imagery originating from Temporal/Occipital region.";
            } else { // lgr >= 0.9
                cerebellum.material = highlightMaterial;
                statusTextDisplay.textContent = "STATE: Embodied Surrender";
                descriptionTextDisplay.textContent = "DESCRIPTION: Full flow state achieved. Automatic awareness centered in Cerebellum. Consciousness is untethered.";
            }

            if (lgr >= 0.9) {
                astralForm.visible = true;
                const intensity = (lgr - 0.9) / 0.1;
                astralMaterial.opacity = intensity * 0.75;
            } else {
                astralForm.visible = false;
            }
        }

        // --- Font and 3D Text Loading ---
        const fontLoader = new THREE.FontLoader();
        fontLoader.load('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/fonts/helvetiker_regular.typeface.json', function (font) {
            const textMaterial = new THREE.MeshBasicMaterial({ color: 0x111111 });
            const textParams = { font: font, size: 0.15, height: 0.01 };
            
            const leftLabelGeom = new THREE.TextGeometry("LEFT (ANALYSIS)", textParams);
            const leftLabel = new THREE.Mesh(leftLabelGeom, textMaterial);
            leftLabel.position.set(-1.8, 0.5, 0);
            labelsGroup.add(leftLabel);

            const rightLabelGeom = new THREE.TextGeometry("RIGHT (INTUITION)", textParams);
            const rightLabel = new THREE.Mesh(rightLabelGeom, textMaterial);
            rightLabel.position.set(0.4, 0.5, 0);
            labelsGroup.add(rightLabel);
        });

        // --- Initial & Event Listeners ---
        lgrSlider.addEventListener('input', () => updateVisualization(parseFloat(lgrSlider.value)));
        updateVisualization(0);

        // --- Animation Loop ---
        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            astralForm.rotation.y = time * 0.5;
            astralForm.rotation.x = time * 0.3;
            labelsGroup.quaternion.copy(camera.quaternion); // Make labels face camera
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // --- STL Export ---
        const exporter = new THREE.STLExporter();
        document.getElementById('export-button').addEventListener('click', () => {
            const stlString = exporter.parse(brainGroup, { binary: true });
            const blob = new Blob([stlString], { type: 'application/octet-stream' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'LGR_Brain_Model_v2.stl';
            link.click();
        });

        // --- Window Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>